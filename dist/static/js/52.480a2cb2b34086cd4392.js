webpackJsonp([52],{"2GhZ":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("mvHQ"),a=s.n(i),n=s("bOdI"),o=s.n(n),c=s("4kSj"),r=s.n(c),p={data:function(){var t;return t={querydate:this.$route.query.querydate,shijianduan:this.$route.query.shijianduan,show:!1,currentTime:this.config.formatDate2(this.config.currentTime()),customerId:"",headImg:"",no:"",customerName:"",appointDate:"",timeScope:"",tel:"",clubName:"",sjtaocan:"",courseType:"",tradePackage:"",fitName:"",number:"",itemName:"",deductions:"",deductionsZz:"",remainNum:"",remainNumZz:"",No:"",plandetailid:"",planDetailName:"",status:"",packageId:"",sysClubCode:"",itemId:"",deductionsBz:"",relaId:"",changeTime:"",classtype1:"",typeList:["1","2","3","4"],show1:!1,orderType:""},o()(t,"no",""),o()(t,"url1",this.config.service_ip1+"/train/?v="+(new Date).getTime()+"#/management/endcourse"),o()(t,"url2",this.config.service_ip1+"/train/?v="+(new Date).getTime()+"#/personaTrain/trainer/trainTemplate"),o()(t,"url3",this.config.service_ip1+"/train/?v="+(new Date).getTime()+"#/management/train_course"),t},created:function(){0==sessionStorage.getItem("secondval")&&(sessionStorage.removeItem("secondval"),this.$router.back()),this._getSingerList()},methods:{_getSingerList:function(t){var e=this,s={page:1,rows:100};s.param={statusArray:"0,5,6,7,8",dateList:this.querydate,name:"asc"},this.instance.$post("/rest/wx/coach/getOrderListPageByCoach",s,function(t){var s=t.results;parseInt(e.shijianduan.replace(/:/g,""));if(console.log(s),s.length>0)for(var i=0;i<s.length;i++){var a="",n="",o="",c=s[i];n=(a=c.timeScope).split("-")[0],o=a.split("-")[1],parseInt(n.replace(/:/g,"")),parseInt(o.replace(/:/g,"")),e.gethourcha(n,o,e.shijianduan)&&(e.customerName=c.customerName,e.tel=c.tel,e.clubName=c.clubName,e.tradePackage=c.tradePackage,e.number=c.number,e.remainNum=c.remainNum,e.deductions=c.deductions,e.appointDate=c.appointDate,e.timeScope=c.timeScope,e.itemName=c.itemName,e.status=c.status,e.No=c.no,e.no=c.no,e.orderType=c.orderType,e.coachplanid=c.coachPlanId,""==c.planDetailId?e.plandetailid=null:e.plandetailid=c.planDetailId,e.customerId=c.customerId,e.planDetailName=c.planDetailName,e.headImg=c.headImg,e.packageId=c.packageId)}},function(t){},t)},gethourcha:function(t,e,s){var i=t.split(":");if(2!=i.length)return!1;var a=e.split(":");if(2!=a.length)return!1;var n=s.split(":");if(2!=a.length)return!1;var o=new Date,c=new Date,r=new Date;return o.setHours(i[0]),o.setMinutes(i[1]),c.setHours(a[0]),c.setMinutes(a[1]),r.setHours(n[0]),r.setMinutes(n[1]),r.getTime()-o.getTime()>=0&&r.getTime()-c.getTime()<0},selectTime:function(){if(0==this.status){var t=this;this.$vux.datetime.show({cancelText:"取消",confirmText:"确定",format:"YYYY-MM-DD HH:mm",hourList:["08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],minuteList:["00","05","10","15","20","25","30","35","40","45","50","55"],value:t.currentTime,startDate:t.currentTime,onConfirm:function(e){new Date((new Date).getTime()).getHours();if(t.timeScope.split("-")[0]>t.timeScope.split("-")[1])var s=t.TimeDifference(t.appointDate+" "+t.timeScope.split("-")[0],t.addDate(t.appointDate)+" "+t.timeScope.split("-")[1]);else s=t.TimeDifference(t.appointDate+" "+t.timeScope.split("-")[0],t.appointDate+" "+t.timeScope.split("-")[1]);var i=new Date(e.replace(/-/g,"/")),a=s;i.setMinutes(i.getMinutes()+a,i.getSeconds(),0);var n={no:t.No,appointDate:e.split(" ")[0],timeScope:e.split(" ")[1]+"-"+t.config.formatDate1(i).split(" ")[1],appoint:e,courseType:t.itemName,itemId:t.itemId,itemName:t.itemName,number:t.number,deductionsBz:t.deductionsBz,deductions:t.deductions,relaId:t.relaId};t.instance.$post("/rest/wx/coach/updateOrderTime",n,function(s){s.status?(t.changeTime=e+"-"+t.config.formatDate1(i).split(" ")[1],t.timeScope=e.split(" ")[1]+"-"+t.config.formatDate1(i).split(" ")[1],t.appointDate=e.split(" ")[0],t.config.showSuccess(t,"修改成功")):t.config.showTip(t,s.message)})}})}},goClass:function(){this.$router.push({name:"classtypes",query:{clubId:this.sysClubCode,packageId:this.packageId,itemname:this.itemName}})},trainByType:function(){},cancel1:function(){this.show1=!1},selectClass:function(){this.show1=!0},businessTypes:function(t){var e=this;if(""!=this.sjtaocan){if(3==this.sjtaocan.packageType||4==this.sjtaocan.packageType){if(parseFloat(this.sjtaocan.remainMoney)<parseFloat(this.deductions)*parseInt(t))return void this.config.showTip(this,"私教套餐余额不足")}else if(1==this.sjtaocan.packageType||2==this.sjtaocan.packageType){if(parseInt(this.sjtaocan.remainCount)<parseInt(t))return void this.config.showTip(this,"私教套餐余次不足");if(this.sjtaocan.remainMoney<=0)return void this.config.showTip(this,"私教套餐余额不足")}var s=this;this.show1=!1;var i=this.appointDate+" "+this.timeScope.split("-")[0],a=new Date(i.replace(/-/g,"/"));if(s.timeScope.split("-")[0]>s.timeScope.split("-")[1])var n=s.TimeDifference(s.appointDate+" "+s.timeScope.split("-")[0],s.addDate(s.appointDate)+" "+s.timeScope.split("-")[1]);else n=s.TimeDifference(s.appointDate+" "+s.timeScope.split("-")[0],s.appointDate+" "+s.timeScope.split("-")[1]);var o=n;a.setMinutes(a.getMinutes()+o,a.getSeconds(),0);var c=parseInt(t)*parseInt(n/this.number)*6e4,r=i.replace(/-/g,"/"),p=new Date(r).getTime()+c,l=i.split(" ")[1]+"-"+this.config.formatDate1(new Date(p)).split(" ")[1],m={no:this.No,appointDate:i.split(" ")[0],timeScope:l,appoint:i,courseType:this.itemName,itemId:this.itemId,itemName:this.itemName,number:t,deductionsBz:this.deductionsBz,deductions:this.deductions,relaId:this.relaId};this.instance.$post("/rest/wx/coach/updateOrderTime",m,function(a){a.status?(e.config.showSuccess(e,"修改成功"),e.number=t,s.timeScope=l,s.appointDate=i.split(" ")[0],s.changeTime=i+"-"+s.timeScope.split("-")[1]):e.config.showTip(e,a.message)})}else this.config.showTip(this,"扣费套餐不存在")},TimeDifference:function(t,e){var s=t,i=e;if(s>i)return!1;var a=s.substr(0,10).split("-"),n=i.substr(0,10).split("-"),o=new Date(a[1]+"/"+a[2]+"/"+a[0]),c=new Date(n[1]+"/"+n[2]+"/"+n[0]),r=parseInt(Math.abs(c-o)/1e3/60),p=60*parseInt(s.substr(11,2))+parseInt(s.substr(14,2));return r+(60*parseInt(i.substr(11,2))+parseInt(i.substr(14,2))-p)},openGlass:function(){null!=this.plandetailid?window.location.href=this.url3+"?planDetailId="+this.plandetailid+"&planDetailName="+this.planDetailName+"&headImg="+this.headImg+"&no="+this.no+"&time="+this.appointDate+"&timeScope="+this.timeScope:this.config.showTip(this,"请添加训练计划")},cancel:function(){var t=this;this.config.showWaiting();var e={orderNo:this.No};r.a.ajax({type:"post",url:this.config.service_ip+"/rest/wx/customer/validateIsEntranceQY",data:e,success:function(e){t.config.closeWaiting(),(e.code="200")?e.status?t.config.showTip(t,"会员已入场，不能取消"):t.show=!t.show:"500"==e.code&&t.config.showTip(t,e.message)},error:function(){this.config.closeWaiting()}})},changePlan:function(){""!=this.no&&7==this.status&&1==this.orderType&&(window.location.href=this.url2+"?customerId="+this.customerId+"&customerName="+this.customerName+"&customerheadimg="+this.headImg+"&no="+this.no+"&changeplan=1")},affirm:function(){var t=this;this.config.showWaiting();var e={flag:"cancel",orderNo:this.No};r.a.ajax({type:"post",url:this.config.service_ip+"/rest/wx/coach/updateOrderStatus",data:e,success:function(e){t.config.closeWaiting(),e.status?(t.config.showSuccess(t,"取消成功"),t.show=!t.show,setTimeout(function(){t.$router.back(-1)},1e3)):t.config.showTip(t,"预约取消失败")},error:function(){this.config.closeWaiting()}})},cen:function(){},findCpByTypesj:function(t,e){var s=this;this.instance.$get("/rest/wx/customer/pac/findCpByType",{params:{clubId:t,fitType:3,customerId:e}},function(t){console.log(a()(t)+"扣费套餐");var e=0;t.rows.forEach(function(t){t.pacList.forEach(function(t){t.sysCustomerPacId==s.packageId&&(s.sjtaocan=t,e=1,console.log(t))})}),0!=e||(s.sjtaocan="")})},evaluate:function(){window.location.href=this.url1+"?coachPlanId="+this.coachplanid+"&planDetailId="+this.plandetailid+"&no="+this.No+"&time="+this.appointDate+"&timeScope="+this.timeScope},addDate:function(t,e){void 0!=e&&""!=e||(e=1),(t=new Date(t)).setDate(t.getDate()+e);var s=t.getMonth()+1,i=t.getDate();return t.getFullYear()+"-"+this.getFormatDate(s)+"-"+this.getFormatDate(i)},getFormatDate:function(t){if(void 0==t||""==t)return"";var e=t+"";return e.length<2&&(e="0"+e),e},cancels:function(){this.show=!this.show}},watch:{$route:function(t,e){var s=this;if(void 0!=e.meta.classtype&&""!=e.meta.classtype){if(console.log(e.meta.classtype),""==this.sjtaocan)return void this.config.showTip(this,"扣费套餐不存在");if(3==this.sjtaocan.packageType||4==this.sjtaocan.packageType){if(parseFloat(this.sjtaocan.remainMoney)<parseFloat(this.deductions)*parseInt(this.number))return void this.config.showTip(this,"私教套餐余额不足")}else if(1==this.sjtaocan.packageType||2==this.sjtaocan.packageType){if(parseInt(this.sjtaocan.remainCount)<parseInt(this.number))return void this.config.showTip(this,"私教套餐余次不足");if(this.sjtaocan.remainMoney<=0)return void this.config.showTip(this,"私教套餐余额不足")}var i=60;e.meta.classtype.courseTime&&""!=e.meta.classtype.courseTime&&0!=e.meta.classtype.courseTime&&(i=e.meta.classtype.courseTime);var a=this.appointDate+" "+this.timeScope.split("-")[0],n=parseInt(this.number)*parseInt(i)*6e4,o=a.replace(/-/g,"/"),c=new Date(o).getTime()+n,r=a.split(" ")[1]+"-"+this.config.formatDate1(new Date(c)).split(" ")[1],p={no:this.No,appointDate:a.split(" ")[0],timeScope:r,appoint:a,courseType:e.meta.classtype.itemsName,itemId:e.meta.classtype.itemId,itemName:e.meta.classtype.itemsName,number:this.number,deductionsBz:e.meta.classtype.itemBzPrice,deductions:e.meta.classtype.itemPrice,relaId:e.meta.classtype.relaId};this.instance.$post("/rest/wx/coach/updateOrderTime",p,function(t){t.status?(s.config.showSuccess(s,"修改成功"),s.classtype1=e.meta.classtype,s.deductions=s.classtype1.itemPrice,s.itemName=s.classtype1.itemsName,s.itemId=s.classtype1.itemId,s.deductionsBz=s.classtype1.itemBzPrice,s.timeScope=r,s.appointDate=a.split(" ")[0],s.changeTime=a+"-"+s.timeScope.split("-")[1],e.meta.classtype=""):s.config.showTip(s,t.message)})}}}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"main"},[i("div",{staticClass:"customerInfo",staticStyle:{"border-top":"1px solid #f7f7f7"}},[i("div",{staticClass:"info"},[i("div",{staticClass:"itemtype"},[t._v("预约类型")]),t._v(" "),i("div",{staticClass:"iteminfo",staticStyle:{color:"#FF0000"}},[t._v(t._s(0==t.orderType?"私教代约":"客户线上预约"))])]),t._v(" "),i("div",{staticClass:"info"},[i("div",{staticClass:"itemtype"},[t._v("客户姓名")]),t._v(" "),i("div",{staticClass:"iteminfo"},[t._v(t._s(t.customerName))])]),t._v(" "),i("div",{staticClass:"info"},[i("div",{staticClass:"itemtype"},[t._v("手机号码")]),t._v(" "),i("div",{staticClass:"iteminfo"},[t._v(t._s(t.tel))])]),t._v(" "),i("div",{staticClass:"info"},[i("div",{staticClass:"itemtype"},[t._v("上课门店")]),t._v(" "),i("div",{staticClass:"iteminfo"},[t._v(t._s(t.clubName))])]),t._v(" "),i("div",{staticClass:"info"},[i("div",{staticClass:"itemtype"},[t._v("扣费套餐")]),t._v(" "),i("div",{staticClass:"iteminfo"},[t._v(t._s(t.tradePackage))])]),t._v(" "),i("div",{staticClass:"info",on:{click:t.goClass}},[i("div",{staticClass:"itemtype"},[t._v("上课类型")]),t._v(" "),i("div",{staticClass:"iteminfo"},[t._v(t._s(""!=t.classtype1?t.classtype1.itemsName:t.itemName))])]),t._v(" "),i("div",{staticClass:"info"},[i("div",{staticClass:"itemtype"},[t._v("上课节数")]),t._v(" "),i("div",{staticClass:"iteminfo"},[t._v(t._s(t.number))])]),t._v(" "),7==t.status&&1==t.orderType&&8!=t.status?i("div",{staticClass:"info",on:{click:t.changePlan}},[i("div",{staticClass:"itemtype"},[t._v("训练计划")]),t._v(" "),i("div",{staticClass:"iteminfo",style:{"padding-right:":""!=t.no?"0.1rem":"",width:""!=t.no?"66%":"",color:null==t.plandetailid?"#999":""}},[t._v(t._s(null==t.plandetailid&&7==t.status&&1==t.orderType?"去添加训练计划":t.planDetailName))]),t._v(" "),""!=t.no?i("img",{staticClass:"arrow",attrs:{src:s("lezY")}}):t._e()]):t._e(),t._v(" "),i("div",{staticClass:"info"},[i("div",{staticClass:"itemtype"},[t._v("上课时间")]),t._v(" "),i("div",{staticClass:"iteminfo"},[t._v(t._s(t.appointDate+" "+t.timeScope))])]),t._v(" "),i("div",{staticClass:"info"},[i("div",{staticClass:"itemtype"},[t._v("私教消费")]),t._v(" "),i("div",{staticClass:"iteminfo",staticStyle:{color:"#FF0000"}},[t._v(t._s(t.remainNum>0?t.number+"次":parseFloat(t.deductions).toFixed(2)*t.number+"元"))])])]),t._v(" "),0==t.status&&8!=t.status?i("div",{staticClass:"btn"},[i("div",{staticClass:"items1",on:{click:t.cancel}},[t._v("取消预约")])]):7==t.status&&1==t.orderType&&8!=t.status?i("div",{staticClass:"btn"},[i("div",{staticClass:"items",on:{click:t.cancel}},[t._v("取消预约")]),t._v(" "),i("div",{staticClass:"items",on:{click:t.openGlass}},[t._v("开始上课")])]):7==t.status&&0==t.orderType?i("div",{staticClass:"btn item",staticStyle:{width:"92%","background-color":"#5176AB",color:"#fff"},on:{click:t.evaluate}},[t._v("评价")]):i("div",{staticClass:"btn item",staticStyle:{width:"92%"}},[t._v(t._s(1==t.status?"已取消":2==t.status?"已结束":3==t.status?"已过期":4==t.status?"已上课":5==t.status?"已入场":6==t.status?"已离场":7==t.status&&0==t.orderType?"评价":8==t.status?"扣费中":"取消成功"))]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"msk",on:{click:t.cancels}},[i("div",{staticClass:"cancel",on:{click:function(e){return e.stopPropagation(),t.cen(e)}}},[i("div",{staticClass:"title"},[t._v("提醒")]),t._v(" "),i("div",{staticClass:"content"},[t._v("确定要取消预约课程吗？")]),t._v(" "),i("div",{staticClass:"menu"},[i("div",{staticClass:"submenu",on:{click:function(e){return e.stopPropagation(),t.cancels(e)}}},[t._v("再想想")]),t._v(" "),i("div",{staticClass:"submenu",on:{click:t.affirm}},[t._v("确定")])])])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.show1,expression:"show1"}],staticClass:"msk",on:{click:function(e){return e.stopPropagation(),t.cancel1(e)}}}),t._v(" "),i("transition",{attrs:{name:"mybox",mode:"out-in"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.show1,expression:"show1"}],staticClass:"businessType"},t._l(t.typeList,function(e,s){return i("div",{key:s,staticClass:"type",on:{click:function(s){return t.businessTypes(e)}}},[t._v(t._s(e)+"节")])}),0)]),t._v(" "),i("transition",{attrs:{name:"slide",mode:"out-in"}},[i("router-view")],1)],1)},staticRenderFns:[]};var m=s("VU/8")(p,l,!1,function(t){s("owgw")},"data-v-66bbed92",null);e.default=m.exports},owgw:function(t,e){}});